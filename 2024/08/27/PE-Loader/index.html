<!DOCTYPE html><html lang="en, fa"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="cybersec, hacking, computer science"><meta name="author" content="Rmxzy"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://ramzxy.github.io/2024/08/27/pe-loader/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="How to write a PE Loader in C with win32 apiPE Loader in windowsThe PE (Portable Executable) format is the executable file format used by Windows, which includes all the information needed to load and"><meta property="og:type" content="article"><meta property="og:title" content="Coding a PE Loader in C"><meta property="og:url" content="https://ramzxy.github.io/2024/08/27/PE-Loader/index.html"><meta property="og:site_name" content="Rmxzy&#39;s Blog"><meta property="og:description" content="How to write a PE Loader in C with win32 apiPE Loader in windowsThe PE (Portable Executable) format is the executable file format used by Windows, which includes all the information needed to load and"><meta property="og:locale"><meta property="article:published_time" content="2024-08-27T10:21:24.211Z"><meta property="article:modified_time" content="2024-09-08T09:10:50.423Z"><meta property="article:author" content="Rmxzy"><meta property="article:tag" content="C"><meta property="article:tag" content="malvware dev"><meta property="article:tag" content="cybersec"><meta property="article:tag" content="WinAPI"><meta name="twitter:card" content="summary"><link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png"><meta name="theme-color" content="#fdb750"><link rel="shortcut icon" href="/images/favicon-32x32.png"><title>Coding a PE Loader in C - Rmxzy&#39;s Blog</title><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/assets/build/styles.css"><link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="/fonts/Geist/geist.css"><script src="/js/libs/anime.min.js"></script><script id="hexo-configurations">window.config={hostname:"ramzxy.github.io",root:"/",language:"en, fa",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,title_alignment:"center",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!1,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!1,default:"cc_by_nc_sa"},lazyload:!0,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#fdb750",secondary:null,default_mode:"dark"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1300px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!1},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/wallhaven-2yvywx_1920x1080.png",dark:"/images/wallhaven-2yvywx_1920x1080.png"},title:"Welcome to Rmxzy's Blog",subtitle:{text:["From each according to his abilities to each according to his needs."],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:1500,backing_delay:1500,loop:!1,smart_backspace:!0},text_color:{light:"#FFF",dark:"#FFF"},text_style:{title_size:"3.0rem",subtitle_size:"1.6rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!0,style:"center",links:{github:"https://github.com/ramzxy",instagram:"https://www.instagram.com/mirza.ilia/",zhihu:null,twitter:"https://x.com/ramsyTheDream",email:"rmsyy@proton.me",telegram:"https://t.me/Rmsy0x"},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.6.4",navbar:{auto_hide:!0,color:{left:"#ff1f42",right:"##fcb403",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Categories:{icon:"fa-solid fa-folder",path:"/categories/"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Links:{icon:"fa-regular fa-link",submenus:{Me:"/about",github:"https://github.com/ramzxy",instagram:"https://www.instagram.com/mirza.ilia/",twitter:"https://x.com/ramsyTheDream"}}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"info",announcement:null,show_on_mobile:!0,links:{Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}}},article_date_format:"MMM D, YYYY",categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2024/8/26 19:45:14"},window.lang_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><link rel="stylesheet" href="/fontawesome/light.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span></div><style>:root{--preloader-background-color:#fff;--preloader-text-color:#000}@media (prefers-color-scheme:dark){:root{--preloader-background-color:#202124;--preloader-text-color:#fff}}@media (prefers-color-scheme:light){:root{--preloader-background-color:#fff;--preloader-text-color:#000}}@media (max-width:600px){.ml13{font-size:2.6rem!important}}.preloader{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;position:fixed;padding:12px;top:0;right:0;bottom:0;left:0;width:100vw;height:100vh;background-color:var(--preloader-background-color);z-index:1100;transition:opacity .2s ease-in-out}.ml13{font-size:3.2rem;color:var(--preloader-text-color);letter-spacing:-1px;font-weight:500;font-family:Chillax-Variable,sans-serif;text-align:center}.ml13 .word{display:inline-flex;flex-wrap:wrap;white-space:nowrap}.ml13 .letter{display:inline-block;line-height:1em}</style><div class="preloader"><h2 class="ml13">Rmxzy&#39;s Blog</h2><script>var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [40,0],
                translateZ: 0,
                opacity: [0,1],
                filter: ['blur(5px)', 'blur(0px)'], // Starting from blurred to unblurred
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i,
            }).add({
                targets: '.ml13 .letter',
                translateY: [0,-40],
                opacity: [1,0],
                filter: ['blur(0px)', 'blur(5px)'], // Ending from unblurred to blurred
                easing: "easeInExpo",
                duration: 1200,
                delay: (el, i) => 100 + 30 * i,
                complete: function() {
                    hidePreloader(); // Call hidePreloader after the animation completes
                }
            });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }</script></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content"><div class="left"><a class="logo-title" href="/">Rmxzy&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> HOME</a></li><li class="navbar-item"><a href="/categories/"><i class="fa-solid fa-folder fa-fw"></i> CATEGORIES</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive fa-fw"></i> ARCHIVES</a></li><li class="navbar-item"><a class="has-dropdown" href="#" onclick="&#34;return" false;&#34;><i class="fa-regular fa-link fa-fw"></i> LINKS <i class="fa-solid fa-chevron-down fa-fw"></i></a><ul class="sub-menu"><li><a href="/about">ME</a></li><li><a target="_blank" rel="noopener" href="https://github.com/ramzxy">GITHUB</a></li><li><a target="_blank" rel="noopener" href="https://www.instagram.com/mirza.ilia/">INSTAGRAM</a></li><li><a target="_blank" rel="noopener" href="https://x.com/ramsyTheDream">TWITTER</a></li></ul></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>HOME </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/"><span>CATEGORIES </span><i class="fa-solid fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>ARCHIVES </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full"><div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" navbar-data-toggle="submenu-Links"><span>LINKS </span><i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i></div><div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links"><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" href="/about">ME</a></div><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" target="_blank" rel="noopener" href="https://github.com/ramzxy">GITHUB</a></div><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" target="_blank" rel="noopener" href="https://www.instagram.com/mirza.ilia/">INSTAGRAM</a></div><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" target="_blank" rel="noopener" href="https://x.com/ramsyTheDream">TWITTER</a></div></div></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags"><span>Tags</span> <i class="fa-regular fa-tags fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">4</div><div class="label text-third-text-color text-sm">Tags</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">2</div><div class="label text-third-text-color text-sm">Categories</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">1</div><div class="label text-third-text-color text-sm">Posts</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><img src="/images/wallhaven-2yjp6x_1920x1080.png" alt="Coding a PE Loader in C" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"><div class="w-full flex items-center absolute bottom-0 justify-center"><h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-semibold backdrop-blur-lg rounded-xl border border-border-color">Coding a PE Loader in C</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/jpg(4).jpeg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Rmxzy</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-08-27 13:51:24</span> <span class="mobile">2024-08-27 13:51:24</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-09-08 12:40:50</span> <span class="mobile">2024-09-08 12:40:50</span> <span class="hover-info">Updated</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/Malware/">Malware</a>&nbsp;</li><li>></li><li><a href="/categories/Malware/Windows/">Windows</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/C/">C</a>&nbsp;</li><li>| <a href="/tags/malvware-dev/">malvware dev</a>&nbsp;</li><li>| <a href="/tags/cybersec/">cybersec</a>&nbsp;</li><li>| <a href="/tags/WinAPI/">WinAPI</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>1.8k Words</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>11 Mins</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h1 id="How-to-write-a-PE-Loader-in-C-with-win32-api"><a href="#How-to-write-a-PE-Loader-in-C-with-win32-api" class="headerlink" title="How to write a PE Loader in C with win32 api"></a>How to write a PE Loader in C with win32 api</h1><h3 id="PE-Loader-in-windows"><a href="#PE-Loader-in-windows" class="headerlink" title="PE Loader in windows"></a>PE Loader in windows</h3><p>The PE (Portable Executable) format is the executable file format used by Windows, which includes all the information needed to load and execute an application or a dynamic link library (DLL). This format consists of two main parts: <strong>headers</strong> and <strong>sections</strong>. In this article, we will examine how to implement a PE Loader in Windows and explain the provided code in detail</p><h3 id="Main-Structure-of-a-PE-Loader"><a href="#Main-Structure-of-a-PE-Loader" class="headerlink" title="Main Structure of a PE Loader"></a>Main Structure of a PE Loader</h3><p>A PE Loader is a program that loads, parses, and executes a PE file (such as an EXE or DLL). The following code implements a simple PE Loader that reads a PE file, performs necessary loading steps, including reading headers, allocating memory, mapping sections, resolving imports, applying relocations, and executing the PE file.</p><h2 id="PE-Loader-Code"><a href="#PE-Loader-Code" class="headerlink" title="PE Loader Code"></a>PE Loader Code</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function prototypes</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LoadPEFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filePath)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ParseHeaders</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS** ntHeaders)</span>;</span><br><span class="line"><span class="type">void</span>* <span class="title function_">AllocateMemoryForImage</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">MapSections</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ResolveImports</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ApplyRelocations</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress, DWORD_PTR delta)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ExecutePE</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;PE file path&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LoadPEFile(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>This code implements a PE Loader that takes a PE file path from the command line, loads the file, and executes it. The key functions of this PE Loader are explained below.</p><h3 id="1-LoadPEFile-Function"><a href="#1-LoadPEFile-Function" class="headerlink" title="1. LoadPEFile Function"></a>1. <code>LoadPEFile</code> Function</h3><p>This function reads the PE file from disk and begins the loading process.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LoadPEFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filePath)</span> &#123;</span><br><span class="line">    FILE* peFile = fopen(filePath, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!peFile) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to open PE file: %s\n&quot;</span>, filePath);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the size of the file</span></span><br><span class="line">    fseek(peFile, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    <span class="type">long</span> fileSize = ftell(peFile);</span><br><span class="line">    fseek(peFile, <span class="number">0</span>, SEEK_SET);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate memory and read the file into the buffer</span></span><br><span class="line">    <span class="type">char</span>* peBuffer = (<span class="type">char</span>*)<span class="built_in">malloc</span>(fileSize);</span><br><span class="line">    fread(peBuffer, <span class="number">1</span>, fileSize, peFile);</span><br><span class="line">    fclose(peFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parse headers and load sections</span></span><br><span class="line">    IMAGE_NT_HEADERS* ntHeaders;</span><br><span class="line">    ParseHeaders(peBuffer, &amp;ntHeaders);</span><br><span class="line">    <span class="type">void</span>* baseAddress = AllocateMemoryForImage(ntHeaders);</span><br><span class="line">    MapSections(peBuffer, ntHeaders, baseAddress);</span><br><span class="line">    ResolveImports(ntHeaders, baseAddress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle relocations</span></span><br><span class="line">    DWORD_PTR delta = (DWORD_PTR)baseAddress - ntHeaders-&gt;OptionalHeader.ImageBase;</span><br><span class="line">    <span class="keyword">if</span> (delta != <span class="number">0</span>) &#123;</span><br><span class="line">        ApplyRelocations(ntHeaders, baseAddress, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ExecutePE(ntHeaders, baseAddress);</span><br><span class="line">    <span class="built_in">free</span>(peBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="2-ParseHeaders-Function"><a href="#2-ParseHeaders-Function" class="headerlink" title="2. ParseHeaders Function"></a>2. <code>ParseHeaders</code> Function</h3><p>This function reads the PE headers from the PE file buffer and verifies whether the PE file is valid.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ParseHeaders</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS** ntHeaders)</span> &#123;</span><br><span class="line">    <span class="comment">// DOS Header</span></span><br><span class="line">    IMAGE_DOS_HEADER* dosHeader = (IMAGE_DOS_HEADER*)peBuffer;</span><br><span class="line">    <span class="keyword">if</span> (dosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid DOS signature.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NT Headers</span></span><br><span class="line">    *ntHeaders = (IMAGE_NT_HEADERS*)(peBuffer + dosHeader-&gt;e_lfanew);</span><br><span class="line">    <span class="keyword">if</span> ((*ntHeaders)-&gt;Signature != IMAGE_NT_SIGNATURE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid PE signature.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Valid PE file.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="3-AllocateMemoryForImage-Function"><a href="#3-AllocateMemoryForImage-Function" class="headerlink" title="3. AllocateMemoryForImage Function"></a>3. <code>AllocateMemoryForImage</code> Function</h3><p>This function allocates memory for the PE image. It first attempts to allocate memory at the preferred base address specified in the PE file, and if that fails, it allocates memory at any available address.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span>* <span class="title function_">AllocateMemoryForImage</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders)</span> &#123;</span><br><span class="line">    <span class="type">void</span>* baseAddress = VirtualAlloc((LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase,</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.SizeOfImage,</span><br><span class="line">        MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">        PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!baseAddress) &#123;</span><br><span class="line">        baseAddress = VirtualAlloc(<span class="literal">NULL</span>,</span><br><span class="line">            ntHeaders-&gt;OptionalHeader.SizeOfImage,</span><br><span class="line">            MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">            PAGE_EXECUTE_READWRITE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!baseAddress) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to allocate memory for image.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Memory allocated at: 0x%p\n&quot;</span>, baseAddress);</span><br><span class="line">    <span class="keyword">return</span> baseAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="4-MapSections-Function"><a href="#4-MapSections-Function" class="headerlink" title="4. MapSections Function"></a>4. <code>MapSections</code> Function</h3><p>This function maps the sections of the PE file into the allocated memory. It first copies the headers to the allocated memory and then maps the sections from the PE file to the appropriate addresses.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MapSections</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(baseAddress, peBuffer, ntHeaders-&gt;OptionalHeader.SizeOfHeaders);</span><br><span class="line"></span><br><span class="line">    IMAGE_SECTION_HEADER* sectionHeader = IMAGE_FIRST_SECTION(ntHeaders);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++, sectionHeader++) &#123;</span><br><span class="line">        <span class="type">void</span>* dest = (<span class="type">char</span>*)baseAddress + sectionHeader-&gt;VirtualAddress;</span><br><span class="line">        <span class="type">void</span>* src = (<span class="type">char</span>*)peBuffer + sectionHeader-&gt;PointerToRawData;</span><br><span class="line">        <span class="built_in">memcpy</span>(dest, src, sectionHeader-&gt;SizeOfRawData);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Mapped section: %s to 0x%p\n&quot;</span>, sectionHeader-&gt;Name, dest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="5-ResolveImports-Function"><a href="#5-ResolveImports-Function" class="headerlink" title="5. ResolveImports Function"></a>5. <code>ResolveImports</code> Function</h3><p>This function resolves the imports of the PE file. It extracts the names of the required DLLs and loads the necessary functions from those DLLs.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ResolveImports</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    IMAGE_IMPORT_DESCRIPTOR* importDesc = (IMAGE_IMPORT_DESCRIPTOR*)((<span class="type">char</span>*)baseAddress +</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (importDesc-&gt;Name) &#123;</span><br><span class="line">        <span class="type">char</span>* dllName = (<span class="type">char</span>*)baseAddress + importDesc-&gt;Name;</span><br><span class="line">        HMODULE hModule = LoadLibraryA(dllName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!hModule) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Failed to load library: %s\n&quot;</span>, dllName);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IMAGE_THUNK_DATA* origFirstThunk = (IMAGE_THUNK_DATA*)((<span class="type">char</span>*)baseAddress + importDesc-&gt;OriginalFirstThunk);</span><br><span class="line">        IMAGE_THUNK_DATA* firstThunk = (IMAGE_THUNK_DATA*)((<span class="type">char</span>*)baseAddress + importDesc-&gt;FirstThunk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (origFirstThunk-&gt;u1.AddressOfData) &#123;</span><br><span class="line">            IMAGE_IMPORT_BY_NAME* importByName = (IMAGE_IMPORT_BY_NAME*)((<span class="type">char</span>*)baseAddress + origFirstThunk-&gt;u1.AddressOfData);</span><br><span class="line">            FARPROC functionAddress = GetProcAddress(hModule, (LPCSTR)importByName-&gt;Name);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!functionAddress) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Failed to resolve import: %s\n&quot;</span>, importByName-&gt;Name);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            firstThunk-&gt;u1.Function = (DWORD_PTR)functionAddress;</span><br><span class="line">            origFirstThunk++;</span><br><span class="line">            firstThunk++;</span><br><span class="line">        &#125;</span><br><span class="line">        importDesc++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Imports resolved.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="6-ApplyRelocations-Function"><a href="#6-ApplyRelocations-Function" class="headerlink" title="6. ApplyRelocations Function"></a>6. <code>ApplyRelocations</code> Function</h3><p>If the PE file is loaded at an address different from its preferred address, this function applies the necessary relocations to ensure that absolute addresses in the PE file work correctly.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ApplyRelocations</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress, DWORD_PTR delta)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (delta == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    IMAGE_BASE_RELOCATION* reloc = (IMAGE_BASE_RELOCATION*)((<span class="type">char</span>*)baseAddress +</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (reloc-&gt;VirtualAddress) &#123;</span><br><span class="line">        WORD* relocItem = (WORD*)((<span class="type">char</span>*)reloc + <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION));</span><br><span class="line">        <span class="type">int</span> numRelocs = (reloc-&gt;SizeOfBlock - <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION)) / <span class="keyword">sizeof</span>(WORD);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numRelocs; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((relocItem[i] &gt;&gt; <span class="number">12</span>) == IMAGE_REL_BASED_HIGHLOW) &#123;</span><br><span class="line">                DWORD* patchAddr = (DWORD*)((<span class="type">char</span>*)baseAddress + reloc-&gt;VirtualAddress + (relocItem[i] &amp; <span class="number">0xFFF</span>));</span><br><span class="line">                *patchAddr += (DWORD)delta;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        reloc = (IMAGE_BASE_RELOCATION*)((<span class="type">char</span>*)reloc + reloc-&gt;SizeOfBlock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Relocations applied.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="7-ExecutePE-Function"><a href="#7-ExecutePE-Function" class="headerlink" title="7. ExecutePE Function"></a>7. <code>ExecutePE</code> Function</h3><p>This function locates the entry point of the PE file and executes it.</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ExecutePE</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    <span class="type">void</span> (*entryPoint)() = (<span class="type">void</span> (*)())((<span class="type">char</span>*)baseAddress + ntHeaders-&gt;OptionalHeader.AddressOfEntryPoint);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Executing PE at entry point: 0x%p\n&quot;</span>, entryPoint</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line">    entryPoint();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="Full-Simple-PE-Loader-x64"><a href="#Full-Simple-PE-Loader-x64" class="headerlink" title="Full Simple PE Loader (x64)"></a>Full Simple PE Loader (x64)</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function prototypes</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LoadPEFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filePath)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ParseHeaders</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS** ntHeaders)</span>;</span><br><span class="line"><span class="type">void</span>* <span class="title function_">AllocateMemoryForImage</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">MapSections</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ResolveImports</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ApplyRelocations</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress, DWORD_PTR delta)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">ExecutePE</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;PE file path&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LoadPEFile(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LoadPEFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filePath)</span> &#123;</span><br><span class="line">    FILE* peFile = fopen(filePath, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!peFile) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to open PE file: %s\n&quot;</span>, filePath);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the size of the file</span></span><br><span class="line">    fseek(peFile, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    <span class="type">long</span> fileSize = ftell(peFile);</span><br><span class="line">    fseek(peFile, <span class="number">0</span>, SEEK_SET);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate memory and read the file into the buffer</span></span><br><span class="line">    <span class="type">char</span>* peBuffer = (<span class="type">char</span>*)<span class="built_in">malloc</span>(fileSize);</span><br><span class="line">    fread(peBuffer, <span class="number">1</span>, fileSize, peFile);</span><br><span class="line">    fclose(peFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parse headers and load sections</span></span><br><span class="line">    IMAGE_NT_HEADERS* ntHeaders;</span><br><span class="line">    ParseHeaders(peBuffer, &amp;ntHeaders);</span><br><span class="line">    <span class="type">void</span>* baseAddress = AllocateMemoryForImage(ntHeaders);</span><br><span class="line">    MapSections(peBuffer, ntHeaders, baseAddress);</span><br><span class="line">    ResolveImports(ntHeaders, baseAddress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle relocations</span></span><br><span class="line">    DWORD_PTR delta = (DWORD_PTR)baseAddress - ntHeaders-&gt;OptionalHeader.ImageBase;</span><br><span class="line">    <span class="keyword">if</span> (delta != <span class="number">0</span>) &#123;</span><br><span class="line">        ApplyRelocations(ntHeaders, baseAddress, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ExecutePE(ntHeaders, baseAddress);</span><br><span class="line">    <span class="built_in">free</span>(peBuffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ParseHeaders</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS** ntHeaders)</span> &#123;</span><br><span class="line">    <span class="comment">// DOS Header</span></span><br><span class="line">    IMAGE_DOS_HEADER* dosHeader = (IMAGE_DOS_HEADER*)peBuffer;</span><br><span class="line">    <span class="keyword">if</span> (dosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid DOS signature.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NT Headers</span></span><br><span class="line">    *ntHeaders = (IMAGE_NT_HEADERS*)(peBuffer + dosHeader-&gt;e_lfanew);</span><br><span class="line">    <span class="keyword">if</span> ((*ntHeaders)-&gt;Signature != IMAGE_NT_SIGNATURE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid PE signature.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Valid PE file.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* <span class="title function_">AllocateMemoryForImage</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders)</span> &#123;</span><br><span class="line">    <span class="comment">// Allocate memory for the image, aligned to the preferred base address</span></span><br><span class="line">    <span class="type">void</span>* baseAddress = VirtualAlloc((LPVOID)ntHeaders-&gt;OptionalHeader.ImageBase,</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.SizeOfImage,</span><br><span class="line">        MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">        PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!baseAddress) &#123;</span><br><span class="line">        <span class="comment">// If allocation at preferred address fails, allocate memory at any available address</span></span><br><span class="line">        baseAddress = VirtualAlloc(<span class="literal">NULL</span>,</span><br><span class="line">            ntHeaders-&gt;OptionalHeader.SizeOfImage,</span><br><span class="line">            MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">            PAGE_EXECUTE_READWRITE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!baseAddress) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to allocate memory for image.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Memory allocated at: 0x%p\n&quot;</span>, baseAddress);</span><br><span class="line">    <span class="keyword">return</span> baseAddress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MapSections</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* peBuffer, IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    <span class="comment">// Copy the headers to the allocated memory</span></span><br><span class="line">    <span class="built_in">memcpy</span>(baseAddress, peBuffer, ntHeaders-&gt;OptionalHeader.SizeOfHeaders);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map sections to memory</span></span><br><span class="line">    IMAGE_SECTION_HEADER* sectionHeader = IMAGE_FIRST_SECTION(ntHeaders);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ntHeaders-&gt;FileHeader.NumberOfSections; i++, sectionHeader++) &#123;</span><br><span class="line">        <span class="type">void</span>* dest = (<span class="type">char</span>*)baseAddress + sectionHeader-&gt;VirtualAddress;</span><br><span class="line">        <span class="type">void</span>* src = (<span class="type">char</span>*)peBuffer + sectionHeader-&gt;PointerToRawData;</span><br><span class="line">        <span class="built_in">memcpy</span>(dest, src, sectionHeader-&gt;SizeOfRawData);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Mapped section: %s to 0x%p\n&quot;</span>, sectionHeader-&gt;Name, dest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ResolveImports</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    IMAGE_IMPORT_DESCRIPTOR* importDesc = (IMAGE_IMPORT_DESCRIPTOR*)((<span class="type">char</span>*)baseAddress +</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (importDesc-&gt;Name) &#123;</span><br><span class="line">        <span class="type">char</span>* dllName = (<span class="type">char</span>*)baseAddress + importDesc-&gt;Name;</span><br><span class="line">        HMODULE hModule = LoadLibraryA(dllName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!hModule) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Failed to load library: %s\n&quot;</span>, dllName);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IMAGE_THUNK_DATA* origFirstThunk = (IMAGE_THUNK_DATA*)((<span class="type">char</span>*)baseAddress + importDesc-&gt;OriginalFirstThunk);</span><br><span class="line">        IMAGE_THUNK_DATA* firstThunk = (IMAGE_THUNK_DATA*)((<span class="type">char</span>*)baseAddress + importDesc-&gt;FirstThunk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (origFirstThunk-&gt;u1.AddressOfData) &#123;</span><br><span class="line">            IMAGE_IMPORT_BY_NAME* importByName = (IMAGE_IMPORT_BY_NAME*)((<span class="type">char</span>*)baseAddress + origFirstThunk-&gt;u1.AddressOfData);</span><br><span class="line">            FARPROC functionAddress = GetProcAddress(hModule, (LPCSTR)importByName-&gt;Name);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!functionAddress) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Failed to resolve import: %s\n&quot;</span>, importByName-&gt;Name);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            firstThunk-&gt;u1.Function = (DWORD_PTR)functionAddress;</span><br><span class="line">            origFirstThunk++;</span><br><span class="line">            firstThunk++;</span><br><span class="line">        &#125;</span><br><span class="line">        importDesc++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Imports resolved.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ApplyRelocations</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress, DWORD_PTR delta)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (delta == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    IMAGE_BASE_RELOCATION* reloc = (IMAGE_BASE_RELOCATION*)((<span class="type">char</span>*)baseAddress +</span><br><span class="line">        ntHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (reloc-&gt;VirtualAddress) &#123;</span><br><span class="line">        WORD* relocItem = (WORD*)((<span class="type">char</span>*)reloc + <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION));</span><br><span class="line">        <span class="type">int</span> numRelocs = (reloc-&gt;SizeOfBlock - <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION)) / <span class="keyword">sizeof</span>(WORD);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numRelocs; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((relocItem[i] &gt;&gt; <span class="number">12</span>) == IMAGE_REL_BASED_HIGHLOW) &#123;</span><br><span class="line">                DWORD* patchAddr = (DWORD*)((<span class="type">char</span>*)baseAddress + reloc-&gt;VirtualAddress + (relocItem[i] &amp; <span class="number">0xFFF</span>));</span><br><span class="line">                *patchAddr += (DWORD)delta;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        reloc = (IMAGE_BASE_RELOCATION*)((<span class="type">char</span>*)reloc + reloc-&gt;SizeOfBlock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Relocations applied.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ExecutePE</span><span class="params">(IMAGE_NT_HEADERS* ntHeaders, <span class="type">void</span>* baseAddress)</span> &#123;</span><br><span class="line">    <span class="comment">// Get the entry point address and call it</span></span><br><span class="line">    <span class="type">void</span> (*entryPoint)() = (<span class="type">void</span> (*)())((<span class="type">char</span>*)baseAddress + ntHeaders-&gt;OptionalHeader.AddressOfEntryPoint);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Executing PE at entry point: 0x%p\n&quot;</span>, entryPoint);</span><br><span class="line">    entryPoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h4 id="Important-Note"><a href="#Important-Note" class="headerlink" title="Important Note"></a>Important Note</h4><p><strong>There is no PE loader that can load all PEs, the most logical way is to write a custom loader for an EXE (in malware development), for example, the above code cannot load Notepad.exe, but it can load clac.exe, the reason for this The difference is the type of PE contents.</strong></p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>This simple PE Loader demonstrates the basic steps required to load and execute a PE file in Windows. In real-world scenarios, more advanced PE Loaders might include additional features like manipulating internal PE structures, more complex header analysis, and various security mechanisms. These types of tools can be used for security testing, malware analysis, or custom software loading and execution.</p></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/C/">#C</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/malvware-dev/">#malvware dev</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/cybersec/">#cybersec</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/WinAPI/">#WinAPI</a>&nbsp;</li></ul></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">Coding a PE Loader in C</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#How-to-write-a-PE-Loader-in-C-with-win32-api"><span class="nav-text">How to write a PE Loader in C with win32 api</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PE-Loader-in-windows"><span class="nav-text">PE Loader in windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Main-Structure-of-a-PE-Loader"><span class="nav-text">Main Structure of a PE Loader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PE-Loader-Code"><span class="nav-text">PE Loader Code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-LoadPEFile-Function"><span class="nav-text">1. LoadPEFile Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ParseHeaders-Function"><span class="nav-text">2. ParseHeaders Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-AllocateMemoryForImage-Function"><span class="nav-text">3. AllocateMemoryForImage Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-MapSections-Function"><span class="nav-text">4. MapSections Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-ResolveImports-Function"><span class="nav-text">5. ResolveImports Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-ApplyRelocations-Function"><span class="nav-text">6. ApplyRelocations Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-ExecutePE-Function"><span class="nav-text">7. ExecutePE Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Full-Simple-PE-Loader-x64"><span class="nav-text">Full Simple PE Loader (x64)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-text">Conclusion</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2024</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Rmxzy</a><p class="post-count space-x-0.5"><span>1 posts in total </span><span>1.8k words in total</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.4</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="fa-regular fa-arrow-up"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script src="/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/tools/imageViewer.js" type="module"></script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/localSearch.js" type="module"></script><script src="/js/tools/codeBlock.js" type="module"></script><script src="/js/layouts/lazyload.js" type="module"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js" type="module"></script><div class="post-scripts" data-swup-reload-script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>